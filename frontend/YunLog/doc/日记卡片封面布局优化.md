# 日记卡片封面布局优化

## 更新日期
2025年10月26日

## 需求说明
在分类详情页面的日记列表中，为每个日记卡片添加封面图片展示，优化视觉效果。

## 实现功能

### 1. 封面图片展示
- 在每个日记卡片上展示第一个附件图片作为封面
- 封面区域为正方形（200rpx × 200rpx）
- 使用 `mode="aspectFill"` 自动裁剪适配正方形区域

### 2. 交替布局
- **奇数次序**（1, 3, 5...）：封面在右侧，内容在左侧
- **偶数次序**（2, 4, 6...）：封面在左侧，内容在右侧
- 通过 `.cover-left` 类控制 `flex-direction: row-reverse`

### 3. 空间分配
- **封面区域**：固定宽度 200rpx，高度 200rpx（正方形）
- **内容区域**：flex: 1（占据剩余空间，约为封面的2倍）
- **总体比例**：封面占 1/3，内容占 2/3

### 4. 响应式处理
- 如果日记没有附件，只显示内容区域
- 封面使用 `flex-shrink: 0` 保持固定尺寸
- 内容区域使用 `flex: 1` 自动填充剩余空间

## 技术实现

### 模板结构
```vue
<view class="diary-item" :class="{ 'cover-left': (diaryList.indexOf(item) + 1) % 2 === 0 }">
  <!-- 封面图片（有附件才显示） -->
  <view class="diary-cover" v-if="item.attachments && item.attachments.length > 0">
    <image class="cover-image" :src="item.attachments[0].url" mode="aspectFill" />
  </view>
  
  <!-- 内容区域 -->
  <view class="diary-content">
    <view class="diary-title">{{ item.title }}</view>
    <view class="diary-content-preview">{{ getPlainTextPreview(item) }}</view>
    <view class="diary-footer">
      <text class="diary-date">{{ FormatDate(item.createTime) }}</text>
    </view>
  </view>
</view>
```

### 核心样式
```scss
.diary-item {
  display: flex;
  flex-direction: row;  // 默认：封面在右
  min-height: 200rpx;
  overflow: hidden;
}

.diary-item.cover-left {
  flex-direction: row-reverse;  // 偶数：封面在左
}

.diary-cover {
  width: 200rpx;
  height: 200rpx;
  flex-shrink: 0;
}

.diary-content {
  flex: 1;
  padding: 24rpx;
}
```

## 布局说明

### 奇数卡片（index % 2 === 1）
```
┌─────────────────────────────────────┐
│  内容区域 (flex: 1)  │ 封面 (200rpx) │
│  ├─ 标题            │   ┌──────┐   │
│  ├─ 预览文本         │   │      │   │
│  └─ 日期            │   │ 图片  │   │
│                     │   │      │   │
│                     │   └──────┘   │
└─────────────────────────────────────┘
```

### 偶数卡片（index % 2 === 0）
```
┌─────────────────────────────────────┐
│ 封面 (200rpx) │  内容区域 (flex: 1)  │
│   ┌──────┐   │  ├─ 标题            │
│   │      │   │  ├─ 预览文本         │
│   │ 图片  │   │  └─ 日期            │
│   │      │   │                     │
│   └──────┘   │                     │
└─────────────────────────────────────┘
```

## 视觉优化

### 1. 图片裁剪
- 使用 `mode="aspectFill"` 确保图片填满正方形区域
- 自动居中裁剪，保持图片主体内容
- 不会出现变形或拉伸

### 2. 内容适配
- 标题单行显示，超出省略
- 预览文本最多显示 2 行（-webkit-line-clamp: 2）
- footer 固定在底部，显示日期信息

### 3. 无封面处理
- 如果日记没有附件，封面区域不显示
- 内容区域自动占满整个卡片宽度
- 保持统一的视觉风格

## 兼容性说明

### 左滑操作兼容
- 新的布局完全兼容现有的左滑功能
- 滑动操作不受封面位置影响
- 橡皮筋效果和动画保持流畅

### 响应式支持
- 使用 rpx 单位，自动适配不同屏幕
- 封面固定尺寸，内容区域弹性伸缩
- 在小屏幕设备上也能正常显示

## 测试要点

1. ✅ 有附件的日记正确显示封面
2. ✅ 无附件的日记不显示封面区域
3. ✅ 奇数和偶数卡片封面位置交替
4. ✅ 图片裁剪正确（不变形）
5. ✅ 左滑操作正常工作
6. ✅ 内容文本正确省略

## 后续优化建议

1. 为封面添加加载状态和失败占位图
2. 考虑添加封面点击放大功能
3. 支持长按封面保存图片
4. 优化图片加载性能（懒加载）
