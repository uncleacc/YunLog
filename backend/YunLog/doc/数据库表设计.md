# 云日记数据库表设计文档

> 本文档基于前端已实现功能设计数据库表结构，采用 MySQL 8.0+，字符集 utf8mb4。

---

## 表设计概览

本系统共设计 **4 张核心表**：
1. **categories** - 分类表
2. **diaries** - 日记表
3. **attachments** - 附件表（图片）
4. 回收站通过 diaries 表的软删除实现

---

## 1. 分类表 (categories)

### 表结构

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| name | VARCHAR | 50 | NOT NULL | - | 分类名称 |
| icon | VARCHAR | 50 | NULL | NULL | 图标（emoji 或图标名称） |
| color | VARCHAR | 20 | NULL | '#FF9A76' | 颜色值（十六进制） |
| is_default | TINYINT(1) | - | NOT NULL | 0 | 是否默认分类（1=是，0=否） |
| create_time | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | - | NULL | NULL ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

### 建表语句

```sql
CREATE TABLE `categories` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `name` VARCHAR(50) NOT NULL COMMENT '分类名称',
  `icon` VARCHAR(50) DEFAULT NULL COMMENT '图标',
  `color` VARCHAR(20) DEFAULT '#FF9A76' COMMENT '颜色值',
  `is_default` TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否默认分类',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='分类表';
```

## 2. 日记表 (diaries)

### 表结构

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| title | VARCHAR | 200 | NOT NULL | '无标题' | 日记标题 |
| content | TEXT | - | NOT NULL | - | 纯文本内容 |
| content_html | TEXT | - | NULL | NULL | HTML格式内容（富文本） |
| category_id | BIGINT | - | NOT NULL | - | 分类ID |
| is_deleted | TINYINT(1) | - | NOT NULL | 0 | 是否删除（软删除标记） |
| deleted_time | DATETIME | - | NULL | NULL | 删除时间 |
| create_time | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| update_time | DATETIME | - | NULL | NULL ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

### 建表语句

```sql
CREATE TABLE `diaries` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `title` VARCHAR(200) NOT NULL DEFAULT '无标题' COMMENT '日记标题',
  `content` TEXT NOT NULL COMMENT '纯文本内容',
  `content_html` TEXT DEFAULT NULL COMMENT 'HTML格式内容',
  `category_id` BIGINT NOT NULL COMMENT '分类ID',
  `is_deleted` TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否删除（0=否，1=是）',
  `deleted_time` DATETIME DEFAULT NULL COMMENT '删除时间',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='日记表';
```

---

## 3. 附件表 (attachments)

### 表结构

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | BIGINT | - | NOT NULL | AUTO_INCREMENT | 主键ID |
| diary_id | BIGINT | - | NOT NULL | - | 日记ID |
| url | VARCHAR | 500 | NOT NULL | - | 图片链接地址 |
| create_time | DATETIME | - | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |

### 建表语句

```sql
CREATE TABLE `attachments` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT '主键ID',
  `diary_id` BIGINT NOT NULL COMMENT '日记ID',
  `url` VARCHAR(500) NOT NULL COMMENT '图片链接地址',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='附件表（图片）';
```

---

## 数据字典

### is_deleted 字段说明
| 值 | 说明 |
|----|------|
| 0  | 正常状态 |
| 1  | 已删除（回收站） |

### is_default 字段说明
| 值 | 说明 |
|----|------|
| 0  | 普通分类 |
| 1  | 默认分类（不可删除） |

---

**文档版本**: v1.0  
**创建日期**: 2025-10-14
