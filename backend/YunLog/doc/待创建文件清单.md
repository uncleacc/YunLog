# 用户认证系统 - 待创建文件清单

## 后端文件（按优先级）

### 高优先级（核心功能）

#### 1. DTO层 (src/main/java/io/github/uncleacc/yunlog/dto/auth/)
```
LoginRequest.java          - 账号密码登录请求
WechatLoginRequest.java    - 微信登录请求
RegisterRequest.java       - 注册请求
AuthResponse.java          - 认证响应（token + 用户信息）
UserInfoDTO.java           - 用户信息DTO
```

#### 2. 工具类 (src/main/java/io/github/uncleacc/yunlog/util/)
```
JwtUtil.java              - JWT工具类（生成token、验证token、解析token）
PasswordEncoder.java      - 密码加密工具（BCrypt）
UserContext.java          - 用户上下文（ThreadLocal存储当前用户）
```

#### 3. 服务层 (src/main/java/io/github/uncleacc/yunlog/service/)
```
AuthService.java          - 认证服务接口
AuthServiceImpl.java      - 认证服务实现（登录、注册、token生成）
UserService.java          - 用户服务接口
UserServiceImpl.java      - 用户服务实现
WechatService.java        - 微信登录服务
```

#### 4. 拦截器 (src/main/java/io/github/uncleacc/yunlog/config/)
```
JwtInterceptor.java       - JWT拦截器（验证token，设置用户上下文）
WebMvcConfig.java         - Web配置（注册拦截器，配置拦截路径）
```

#### 5. 控制器 (src/main/java/io/github/uncleacc/yunlog/controller/)
```
AuthController.java       - 认证控制器（/api/auth/...）
```

#### 6. 配置 (src/main/resources/)
```
application.yml           - 添加JWT和微信配置
```

#### 7. 依赖 (pom.xml)
```xml
添加JWT、Spring Security Crypto、HttpClient依赖
```

### 中优先级（现有API适配）

#### 8. 实体类修改
```
Diary.java                - 添加userId字段和关联
Category.java             - 添加userId字段和关联
```

#### 9. 服务层修改
```
DiaryServiceImpl.java     - 查询/创建/更新日记时按用户过滤
CategoryServiceImpl.java  - 查询/创建/更新分类时按用户过滤
AttachmentServiceImpl.java- 附件操作时验证权限
```

### 低优先级（前端实现）

#### 10. 前端页面
```
pages/login/login.vue     - 登录页面（账号密码+微信登录）
pages/login/login.js      - 登录页面逻辑
pages/login/login.css     - 登录页面样式
```

#### 11. 前端工具类
```
utils/auth.js             - 认证工具（token存储、登录状态检查）
utils/request.js          - 修改：自动携带token、401处理
utils/api.js              - 添加：认证相关API接口
```

#### 12. 前端页面修改
```
pages/profile/profile.vue - 添加登出按钮、显示用户信息
pages/index/index.vue     - 添加登录检查
pages.json                - 添加login页面配置
```

## 实现建议

### 方案A：快速原型（推荐先做这个）
1. 仅实现账号密码登录
2. 创建核心文件：DTO、JwtUtil、AuthService、AuthController、JwtInterceptor
3. 简单修改Diary和Category添加userId字段
4. 前端创建简单登录页
5. 测试基本登录流程

完成后再扩展微信登录和完整的数据隔离。

### 方案B：完整实现
一次性创建所有文件，实现完整功能。

## 当前状态
- ✅ 数据库迁移脚本已执行
- ✅ User实体类已创建
- ✅ UserRepository已创建
- ⏳ DTO层待创建
- ⏳ 服务层待创建
- ⏳ 控制器待创建
- ⏳ 拦截器待创建
- ⏳ 前端待实现

## 下一步行动
请选择：
1. 继续完成后端核心文件（我可以批量创建）
2. 先实现方案A的快速原型
3. 分步骤详细实现每个模块

建议选择方案A，可以最快看到效果。
