# 分类功能说明 - V3.0

## 更新时间
2025-10-12

## 功能概述

新增分类（文件夹）系统，让日记管理更有条理。每个分类就像一个文件夹，可以存放不同主题的日记。

## 核心改动

### 1. 页面结构变化

#### 之前（V2.0）
```
首页 → 显示所有日记列表
      → 右下角：添加日记按钮
      → 左下角：垃圾桶按钮
```

#### 现在（V3.0）
```
首页 → 显示分类文件夹列表 + 全局统计
      → 点击分类 → 分类详情页（该分类的日记列表）
                    → 右下角：添加日记按钮（仅此处有）
      → 左下角：回收站按钮
      → 右下角：管理分类按钮
```

### 2. 页面架构

```
┌─────────────────────────────────────┐
│           首页 (index)               │
│  ┌───────────────────────────────┐  │
│  │  全局统计：总日记数 + 连续天数  │  │
│  └───────────────────────────────┘  │
│                                      │
│  📁 默认分类          5篇日记  >    │
│  🎨 工作日志          3篇日记  >    │
│  💼 学习笔记          8篇日记  >    │
│                                      │
│  [回收站]          [管理分类]       │
└─────────────────────────────────────┘
                ↓ 点击分类
┌─────────────────────────────────────┐
│      分类详情页 (category)           │
│  ┌───────────────────────────────┐  │
│  │      📁 默认分类                │
│  │        5篇日记                  │
│  └───────────────────────────────┘  │
│                                      │
│  ┌─ 日记1 ─────────────────────┐   │
│  │ 今天的工作总结...             │   │
│  └──────────────────────────────┘   │
│  ┌─ 日记2 ─────────────────────┐   │
│  │ 学习笔记...                   │   │
│  └──────────────────────────────┘   │
│                                      │
│                            [+]       │
└─────────────────────────────────────┘
```

## 数据结构

### 分类对象
```javascript
{
  id: String,        // 唯一标识
  name: String,      // 分类名称
  icon: String,      // 图标emoji
  color: String,     // 颜色（十六进制）
  createTime: String // 创建时间
}
```

### 日记对象（新增字段）
```javascript
{
  id: String,
  title: String,
  content: String,
  contentHtml: String,
  attachments: Array,
  categoryId: String,    // ← 新增：所属分类ID
  createTime: String,
  updateTime: String
}
```

## 功能详解

### 1. 首页（分类列表）

#### 显示内容
- **顶部统计卡片**：
  - 总日记数：所有分类的日记总和
  - 连续天数：只要任意分类今天有日记就算连续
  
- **分类文件夹列表**：
  - 分类图标 + 名称
  - 该分类的日记数量
  - 点击进入分类详情

- **底部按钮**：
  - 左侧：回收站按钮
  - 右侧：管理分类按钮

#### 连续天数计算规则
```
假设有3个分类：工作、生活、学习

10月10日：工作有1篇   ✓ 
10月11日：生活有1篇   ✓ （继续连续）
10月12日：学习有1篇   ✓ （继续连续）
10月13日：无任何日记  ✗ （中断）

结果：连续3天
```

**重点**：不需要每个分类每天都有，只要任意一个分类当天有就算连续。

### 2. 分类详情页

#### 功能
- 显示该分类下的所有日记
- 支持查看、编辑、删除日记
- **唯一的添加按钮位置**：右下角浮动按钮
- 点击添加按钮，新建的日记自动归属当前分类

#### 特点
- 顶部显示分类信息卡片（带分类颜色）
- 日记列表展示（与之前一样）
- 空状态提示

### 3. 分类管理页

#### 功能
- **查看所有分类**：列表展示
- **添加新分类**：
  - 输入名称（最多10字）
  - 选择图标（16种可选）
  - 选择颜色（10种可选）
  
- **编辑分类**：
  - 长按分类弹出菜单
  - 可修改名称、图标、颜色
  
- **删除分类**：
  - 长按选择删除
  - 该分类下的日记自动移到"默认分类"
  - **默认分类不可删除**

#### 图标选项
```
📁 📝 💼 🎨 🎵 🏃 💡 🌟 
❤️ 🎯 📚 ✈️ 🍕 ☕ 🎮 📷
```

#### 颜色选项
```
#FF9A76  橙色
#FF6B6B  红色
#4ECDC4  青色
#45B7D1  蓝色
#FFA07A  浅橙
#98D8C8  青绿
#F7DC6F  黄色
#BB8FCE  紫色
#85C1E2  天蓝
#F8B88B  粉橙
```

### 4. 编辑页改动

#### 新增逻辑
- 从分类详情页点击添加：自动关联该分类
- 编辑已有日记：保持原分类不变
- 分类ID自动保存，用户无需手动选择

## 使用流程

### 创建日记
```
1. 首页 → 点击某个分类（如"工作日志"）
2. 进入分类详情页
3. 点击右下角 [+] 按钮
4. 编写日记
5. 保存 → 自动归入"工作日志"分类
```

### 管理分类
```
1. 首页 → 点击 [管理分类] 按钮
2. 查看所有分类
3. 点击 [添加新分类]
4. 输入名称、选择图标和颜色
5. 确定 → 新分类创建完成
6. 返回首页即可看到新分类
```

### 编辑分类
```
1. 首页 → 点击 [管理分类]
2. 长按要编辑的分类
3. 选择操作：
   - 编辑名称（快速修改）
   - 修改图标和颜色（完整编辑）
   - 删除分类（谨慎操作）
```

## 技术实现

### 核心API

#### 分类管理
```javascript
// 获取所有分类
storage.GetCategoryList()

// 添加分类
storage.AddCategory({ name, icon, color })

// 更新分类
storage.UpdateCategory(id, { name, icon, color })

// 删除分类
storage.DeleteCategory(id)
```

#### 日记管理（新增）
```javascript
// 根据分类获取日记
storage.GetDiaryListByCategory(categoryId)

// 获取分类统计
storage.GetCategoryStats(categoryId)

// 获取全局统计
storage.GetGlobalStats()
```

### 连续天数算法
```javascript
GetGlobalStats() {
  // 1. 获取所有日记
  // 2. 按日期分组（去重）
  // 3. 从今天开始往前数
  // 4. 每天只要有一篇日记就算连续
  // 5. 中断则停止计数
}
```

## 路由配置

新增页面路由：
```json
{
  "path": "pages/category/category",
  "style": { "navigationBarTitleText": "分类详情" }
},
{
  "path": "pages/category-manage/category-manage",
  "style": { "navigationBarTitleText": "管理分类" }
}
```

## 默认分类

系统自动创建一个"默认分类"：
- ID: `default`
- 名称: 默认分类
- 图标: 📝
- 颜色: #FF9A76
- 特点：不可删除，可以修改名称

## 优势特点

### 1. 清晰的分类管理
- 不同主题的日记分开存放
- 一目了然的数量统计
- 快速找到相关日记

### 2. 灵活的组织方式
- 自定义分类名称
- 个性化图标和颜色
- 自由增删分类

### 3. 统一的统计视图
- 首页展示全局数据
- 连续天数激励机制
- 跨分类统计

### 4. 防误操作设计
- 删除分类时日记自动归档
- 默认分类保底
- 二次确认机制

## 使用建议

### 分类规划示例

#### 方案1：按主题分类
```
📝 日常生活
💼 工作笔记
📚 学习记录
✈️ 旅行游记
💡 灵感创意
```

#### 方案2：按心情分类
```
😊 开心时刻
😢 情绪日记
🤔 思考感悟
❤️ 感恩日记
⭐ 成就记录
```

#### 方案3：按项目分类
```
🎯 项目A日志
🎨 项目B进展
📷 摄影作品
🎵 音乐创作
🏃 健身打卡
```

## 注意事项

1. ⚠️ 删除分类不会删除日记，日记会自动移到默认分类
2. ⚠️ 默认分类不能删除，但可以修改名称
3. ⚠️ 分类名称最多10个字符
4. ✅ 添加日记按钮只在分类详情页，避免误操作
5. ✅ 首页只展示分类，进入分类才能看到日记

## 升级说明

从V2.0升级到V3.0：
- ✅ 自动为旧日记分配"默认分类"
- ✅ 数据向下兼容，不会丢失
- ✅ 首页布局完全改变，注意适应

## 版本历史

- **V3.0** - 2025-10-12
  - ✨ 新增分类系统
  - 🔄 首页改为分类列表
  - 📊 全局统计优化
  - 🎯 添加按钮位置调整

- **V2.1** - 2025-10-12
  - 富文本编辑
  - 表情矩阵布局

- **V2.0** - 2025-10-12
  - 垃圾桶
  - 附件上传
  - 工具栏

- **V1.0** - 2025-10-12
  - 基础日记功能

## 后续优化建议

1. 🔍 分类内搜索
2. 📊 分类数据统计图表
3. 🎨 更多图标和颜色选择
4. 📱 分类拖拽排序
5. 🏷️ 分类标签系统
6. 🔒 分类加密功能

