# 格式状态调试验证清单

## 快速测试步骤

### 步骤1: 基础功能验证
1. **打开编辑页面**，进入任一日记编辑界面
2. **查看控制台**，应该看到编辑器初始化日志
3. **点击编辑器**，应该看到 `onEditorSelectionChange` 日志

### 步骤2: 格式按钮状态验证
1. **点击粗体按钮（B）**：
   - 控制台应显示：`EditorToolbar - 点击格式按钮: bold`
   - 控制台应显示：`ToggleFormat - 激活全局 bold 格式`
   - 按钮应该高亮（变橙色）

2. **输入文字**：
   - 新输入的文字应该是粗体
   - 输入时不应该失去粗体格式

3. **移动光标**：
   - 点击到其他位置再回到粗体文字中间
   - 粗体按钮应该保持高亮状态

### 步骤3: 选中文本验证
1. **输入普通文本和粗体文本**：
   ```
   普通文本 **粗体文本** 普通文本
   ```

2. **选中普通文本**：
   - 所有格式按钮应该不高亮
   - 控制台显示：`有选中文本: true`

3. **选中粗体文本**：
   - 粗体按钮应该高亮
   - 控制台显示格式状态包含 `bold: true`

4. **选中混合文本**（普通+粗体）：
   - 如果选中区域包含任何粗体，粗体按钮应该高亮

### 步骤4: 格式切换验证
1. **选中普通文本，点击粗体按钮**：
   - 选中的文本应该变为粗体
   - 按钮立即高亮

2. **选中粗体文本，点击粗体按钮**：
   - 选中的文本应该取消粗体
   - 按钮不再高亮

## 关键调试信息

### 必须看到的日志
```
onEditorSelectionChange - 编辑器选择变化: {bold: true, italic: false, ...}
onEditorSelectionChange - 选中文本: "文本内容" 长度: 4
UpdateToolbarFromSelection - 更新工具栏按钮状态: {bold: true} 有选中文本: true
EditorToolbar - 格式状态变化: {old: {...}, new: {...}}
```

### 状态检查点
1. **formatStates 值**：工具栏按钮的显示状态
2. **globalFormatStates 值**：全局格式状态
3. **事件中的格式信息**：`e.detail` 包含的格式状态

## 常见问题及解决

### 问题1: 按钮不高亮
- **原因**：`formatStates` 没有正确更新
- **检查**：控制台中 `UpdateToolbarFromSelection` 的日志
- **解决**：确认格式状态值是布尔类型

### 问题2: 格式不生效
- **原因**：编辑器上下文未正确获取
- **检查**：`editorCtx` 是否为 null
- **解决**：确认编辑器初始化完成

### 问题3: 状态不同步
- **原因**：事件处理逻辑错误
- **检查**：`onEditorSelectionChange` 是否被正确触发
- **解决**：检查事件绑定和参数传递

## 预期结果

✅ **成功指标**：
- 光标移动时，按钮状态实时反映当前位置格式
- 选中文本时，按钮状态反映选中内容格式
- 点击按钮后，格式正确应用且状态立即更新
- 输入新文本时，应用当前的全局格式状态

❌ **失败指标**：
- 按钮状态不变化
- 格式应用后按钮状态不更新  
- 选中不同格式文本时按钮状态错误
- 控制台出现错误日志

---

**测试完成后**：请记录测试结果，如有问题提供详细的控制台日志。