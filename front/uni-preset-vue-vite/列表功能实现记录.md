# 列表功能实现记录

## 功能描述
参考 `editor.vue` 的实现，为日记编辑器添加有序列表和无序列表功能。

## 实现内容

### 1. 工具栏按钮 (`EditorToolbar.vue`)

**新增按钮**：
- 有序列表按钮：显示 "1." 图标
- 无序列表按钮：显示 "•" 图标

**状态管理**：
```vue
<!-- 有序列表按钮 -->
<view 
  class="tool-btn" 
  :class="{ 'tool-btn-active': formatStates.listOrdered }"
  @click="onToggleList('ordered')"
>
  <text class="tool-text">1.</text>
</view>

<!-- 无序列表按钮 -->
<view 
  class="tool-btn" 
  :class="{ 'tool-btn-active': formatStates.listBullet }"
  @click="onToggleList('bullet')"
>
  <text class="tool-text">•</text>
</view>
```

**Props 更新**：
- 添加 `listOrdered: false` 和 `listBullet: false` 到默认格式状态
- 添加 `toggle-list` 事件到 emits

### 2. 格式状态管理 (`useEditorFormat.js`)

**状态扩展**：
```javascript
const formatStates = ref({
  bold: false,
  italic: false,
  underline: false,
  strikethrough: false,
  listOrdered: false,    // 新增：有序列表状态
  listBullet: false      // 新增：无序列表状态
})
```

**状态更新逻辑**：
```javascript
// 在 updateToolbarFromSelection 中添加
formatStates.value.listOrdered = currentFormats.list === 'ordered'
formatStates.value.listBullet = currentFormats.list === 'bullet'
```

**列表切换函数**：
```javascript
const toggleList = (editorCtx, listType) => {
  if (!editorCtx) return
  console.log('ToggleList - 切换列表格式:', listType)
  
  // 直接使用编辑器的 format 方法
  editorCtx.format('list', listType)
  
  console.log(`ToggleList - 已调用编辑器列表格式方法: list, ${listType}`)
}
```

### 3. 主组件集成 (`edit.vue`)

**事件绑定**：
```vue
<EditorToolbar 
  :format-states="formatStates"
  @toggle-format="handleToggleFormat"
  @toggle-list="handleToggleList"          <!-- 新增：列表事件 -->
  @show-emoji-picker="handleShowEmojiPicker"
  @toggle-attachment-bar="handleToggleAttachmentBar"
/>
```

**事件处理**：
```javascript
// 处理列表切换
handleToggleList(listType) {
  this.toggleList(this.editorCtx, listType)
},
```

**状态同步**：
```javascript
// 在 handleEditorStatusChange 中添加
this.formatStates.listOrdered = formats.list === 'ordered'
this.formatStates.listBullet = formats.list === 'bullet'
```

## 技术实现

### 列表格式映射
| 列表类型 | 编辑器格式名 | 编辑器格式值 | 按钮状态 |
|---------|-------------|-------------|----------|
| 有序列表 | list | ordered | listOrdered |
| 无序列表 | list | bullet | listBullet |

### 事件流程
1. **用户点击** → 列表按钮
2. **事件触发** → `@click="onToggleList('ordered/bullet')"`  
3. **事件发射** → `this.$emit('toggle-list', listType)`
4. **父组件处理** → `handleToggleList(listType)`
5. **调用Hook** → `this.toggleList(this.editorCtx, listType)`
6. **编辑器执行** → `editorCtx.format('list', listType)`
7. **状态更新** → `@statuschange` 触发 `handleEditorStatusChange`
8. **UI同步** → 按钮高亮状态更新

### 状态逻辑
- **互斥性**：有序列表和无序列表是互斥的
- **切换性**：点击已激活的列表按钮会取消列表格式
- **实时性**：状态通过 `statuschange` 事件实时同步

## 使用方法

### 创建有序列表
1. 点击 "1." 按钮激活有序列表模式
2. 输入文本，每次回车会自动创建新的列表项
3. 再次点击 "1." 按钮可以退出列表模式

### 创建无序列表  
1. 点击 "•" 按钮激活无序列表模式
2. 输入文本，每次回车会自动创建新的列表项
3. 再次点击 "•" 按钮可以退出列表模式

### 切换列表类型
1. 在列表中选择需要改变的内容
2. 点击另一种列表按钮即可转换格式

## 测试验证

### 基础功能测试
- [ ] 点击有序列表按钮，创建编号列表
- [ ] 点击无序列表按钮，创建项目符号列表
- [ ] 在列表中回车，自动创建新列表项
- [ ] 再次点击相同按钮，退出列表模式

### 状态同步测试
- [ ] 光标在有序列表中时，有序列表按钮应该高亮
- [ ] 光标在无序列表中时，无序列表按钮应该高亮
- [ ] 光标在普通文本中时，列表按钮都不高亮
- [ ] 选中列表内容时，对应按钮正确高亮

### 格式切换测试
- [ ] 有序列表转无序列表
- [ ] 无序列表转有序列表
- [ ] 列表转普通文本
- [ ] 普通文本转列表

### 兼容性测试
- [ ] 与其他格式（粗体、斜体等）的组合使用
- [ ] 嵌套列表的支持情况
- [ ] 列表项内的格式保持

## 注意事项

1. **格式名称**：编辑器使用 `'list'` 作为格式名，值为 `'ordered'` 或 `'bullet'`
2. **状态检测**：通过 `formats.list === 'ordered'` 检测有序列表状态
3. **事件依赖**：依赖编辑器的 `statuschange` 事件进行状态同步
4. **按钮图标**：使用简单文本 "1." 和 "•" 作为按钮图标

---

**实现时间**：2025年10月13日  
**功能特点**：完全基于编辑器原生列表支持，状态实时同步，操作简单直观