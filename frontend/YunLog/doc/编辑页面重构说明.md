# 编辑页面重构说明

## 修改时间
2025年10月27日

## 修改内容

### 1. 页面布局重构 ✅
**目标**：整个页面都是文本编辑器，工具栏位于底部

**修改点**：
- 移除了独立的 `AttachmentManager`、`EditorToolbar`、`EditorArea`、`ActionBar` 组件
- 将富文本编辑器直接嵌入页面，占满整个可用空间
- 编辑器使用 `flex: 1` 自动填充剩余空间
- 附件预览改为顶部轻量展示区域（仅在有附件时显示）

### 2. 底部工具栏优化 ✅
**目标**：工具栏位于底部，输入法弹起时跟随键盘

**实现方式**：
```css
.bottom-toolbar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 999;
}
```

**工具栏布局**：
- **左侧**：格式工具（B、I、U、S、有序列表、无序列表）
- **右侧**：
  - 时间图标（time.png，仅编辑模式）
  - 附件图标（attachment.png）
  - 字符数显示（当前/3000）
  - 完成按钮

### 3. 字符数显示优化 ✅
**变更**：
- 从"字符数: 120" → "120/3000"
- 显示当前字符数和上限
- 样式优化，使用圆角背景

### 4. 功能图标替换 ✅
**替换的图标**：
- ~~📅 Emoji~~ → `time.png` （时间设置）
- ~~📎 Emoji~~ → `attachment.png` （附件管理）

**图标规格**：
- 尺寸：200px × 200px
- 格式：PNG with RGBA
- 显示尺寸：36rpx × 36rpx

### 5. 交互优化
**改进点**：
- 编辑器自动获得焦点（`auto-focus="true"`）
- 附件预览紧凑化，点击可预览大图
- 删除按钮优化为圆形图标
- 工具栏按钮统一样式和交互反馈

## 文件结构变化

### 修改的文件
```
frontend/YunLog/src/pages/edit/edit.vue
└── 完全重构，简化组件依赖
```

### 新增的图标
```
frontend/YunLog/src/static/tabbar/
├── time.png         # 时间设置图标
└── attachment.png   # 附件图标
```

### 移除的依赖
- `AttachmentManager.vue` （改为内联）
- `EditorToolbar.vue` （改为内联）
- `EditorArea.vue` （改为内联）
- `ActionBar.vue` （改为内联）

### 保留的组件
- `CalendarPicker.vue` （日历选择器）

## 样式规范

### 颜色方案
```css
主色调: #FF9A76
背景色: #FFFFFF
次要背景: #F8F8F8
边框色: #F0F0F0
文字色: #333333
次要文字: #666666
```

### 间距规范
```css
工具栏内边距: 16rpx 20rpx
按钮尺寸: 56rpx × 56rpx
按钮间距: 8rpx - 12rpx
```

## 功能保留

### 已保留功能 ✅
- ✅ 富文本编辑（加粗、斜体、下划线、删除线、列表）
- ✅ 附件上传和管理
- ✅ 图片预览
- ✅ 时间修改（编辑模式）
- ✅ 字符数限制（3000字）
- ✅ 内容自动保存
- ✅ 表情符号支持

### 移除功能
- ❌ 独立的附件栏切换按钮
- ❌ 取消按钮（使用导航返回代替）
- ❌ 分类选择（保留在创建时指定）
- ❌ 时间信息卡片展示

## 测试要点

### 需要测试的场景
1. **编辑器输入**
   - [ ] 普通文本输入
   - [ ] 表情符号输入
   - [ ] 格式化文本
   - [ ] 列表功能
   - [ ] 字符数限制（3000字）

2. **附件管理**
   - [ ] 添加图片（拍照）
   - [ ] 添加图片（相册）
   - [ ] 图片预览
   - [ ] 删除附件
   - [ ] 附件上传到 OSS

3. **工具栏**
   - [ ] 格式按钮响应
   - [ ] 工具栏随输入法弹起
   - [ ] 字符数实时更新
   - [ ] 保存按钮状态

4. **时间设置**
   - [ ] 打开日历选择器
   - [ ] 选择日期
   - [ ] 保存时间修改

5. **页面导航**
   - [ ] 新建日记
   - [ ] 编辑现有日记
   - [ ] 保存后返回
   - [ ] 未保存提示

## 兼容性说明

### 支持的平台
- ✅ 微信小程序
- ✅ H5（需测试）
- ⚠️ App（需测试）

### 已知限制
- 字符数上限：3000字
- 附件数量：建议不超过9张
- 图片格式：PNG、JPG
- 图片大小：后端限制

## 后续优化建议

1. **性能优化**
   - 大图片压缩
   - 附件懒加载
   - 编辑器防抖优化

2. **功能增强**
   - 草稿自动保存
   - 离线编辑支持
   - 更多格式选项（字体、颜色）

3. **用户体验**
   - 工具栏可定制
   - 快捷键支持
   - 手势操作

## 回滚方案

如果新版本有问题，可以通过以下步骤回滚：

1. 恢复 `edit.vue` 到重构前版本
2. 恢复相关组件文件
3. 移除新增的图标文件（可选）

备份文件路径：
```
git checkout HEAD~1 frontend/YunLog/src/pages/edit/edit.vue
```
