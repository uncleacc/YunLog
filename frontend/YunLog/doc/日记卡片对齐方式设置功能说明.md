# 日记卡片对齐方式设置功能说明

## 功能概述

在设置页面添加了"日记卡片对齐"选项，用户可以自定义分类详情页中日记卡片的封面和文字对齐方式。

---

## 功能特性

### 两种对齐模式

#### 1. **奇偶交替模式**（默认）
- **奇数次序**：封面在右侧，文字在左侧左对齐
- **偶数次序**：封面在左侧，文字在右侧右对齐
- **效果**：视觉上更加活泼、富有变化

#### 2. **默认对齐模式**
- **所有卡片**：封面统一在右侧，文字在左侧左对齐
- **效果**：视觉上更加统一、整齐

---

## 使用方式

1. 进入「我的」→「设置」
2. 点击「日记卡片对齐」选项
3. 在弹出的菜单中选择对齐方式：
   - 奇偶交替
   - 默认对齐
4. 系统会自动保存设置
5. 返回分类详情页即可看到效果

---

## 技术实现

### 文件修改

#### 1. **设置页面** (`pages/settings/settings.vue`)
```vue
- 添加了「日记卡片对齐」设置项
- 显示当前选中的对齐方式
- 点击后弹出选择菜单
- 保存设置到 localStorage
- 通过 uni.$emit 通知其他页面更新
```

#### 2. **分类详情页** (`pages/category/category.vue`)
```javascript
// 新增数据
cardAlignment: 'alternate' // 对齐方式

// 新增方法
LoadAlignment()          // 加载对齐设置
OnAlignmentChanged()     // 监听对齐变化
getDiaryItemClass()      // 获取卡片样式类
getDiaryContentClass()   // 获取内容样式类
```

#### 3. **存储工具** (`utils/storage.js`)
```javascript
GetCardAlignment()  // 获取对齐方式
SetCardAlignment()  // 保存对齐方式
```

### 数据存储

- **键名**：`diary_card_alignment`
- **值**：`'alternate'` | `'default'`
- **存储位置**：`uni.storage`（localStorage）

### 样式类说明

#### `.cover-right`
```css
flex-direction: row-reverse
```
作用：封面在右侧

#### `.align-right`
```css
text-align: right
```
作用：文字右对齐

---

## 逻辑流程

### 设置流程
```
用户点击设置项
  ↓
显示选择菜单
  ↓
用户选择对齐方式
  ↓
保存到 localStorage
  ↓
发送 uni.$emit('alignmentChanged')
  ↓
显示成功提示
```

### 应用流程
```
分类详情页加载 (onLoad)
  ↓
读取 localStorage 中的对齐设置
  ↓
根据设置动态计算样式类
  ↓
应用到日记卡片
```

### 实时更新流程
```
设置页保存设置
  ↓
uni.$emit('alignmentChanged', alignment)
  ↓
分类详情页监听事件 (uni.$on)
  ↓
更新 cardAlignment
  ↓
Vue 响应式自动更新 DOM
```

---

## 代码示例

### 获取样式类（分类详情页）

```javascript
getDiaryItemClass(index) {
  if (this.cardAlignment === 'default') {
    // 默认模式：所有封面都在右侧
    return 'cover-right'
  } else {
    // 奇偶交替模式：奇数在右，偶数在左
    return (index + 1) % 2 === 1 ? 'cover-right' : ''
  }
}

getDiaryContentClass(index) {
  if (this.cardAlignment === 'default') {
    // 默认模式：所有文字都左对齐
    return ''
  } else {
    // 奇偶交替模式：偶数右对齐
    return (index + 1) % 2 === 0 ? 'align-right' : ''
  }
}
```

### 模板中使用

```vue
<view 
  class="diary-item" 
  :class="getDiaryItemClass(index)"
>
  <view class="diary-cover">...</view>
  <view 
    class="diary-content" 
    :class="getDiaryContentClass(index)"
  >
    ...
  </view>
</view>
```

---

## 兼容性说明

- ✅ 对已有功能无影响
- ✅ 默认使用奇偶交替模式，保持原有视觉效果
- ✅ 用户未设置时自动使用默认值
- ✅ 设置实时生效，无需重启应用

---

## 测试清单

- [x] 设置页面显示正常
- [x] 点击设置项弹出选择菜单
- [x] 选择后正确保存设置
- [x] 分类详情页正确读取设置
- [x] 奇偶交替模式显示正确
- [x] 默认对齐模式显示正确
- [x] 设置实时生效（无需刷新）
- [x] 应用重启后设置保持

---

## 后续优化建议

1. **更多对齐选项**
   - 所有封面在左侧
   - 无封面纯文字模式
   
2. **卡片样式自定义**
   - 卡片圆角大小
   - 封面尺寸比例
   - 文字大小
   
3. **主题设置**
   - 浅色/深色主题
   - 自定义主题色

---

## 问题反馈

如在使用过程中遇到问题，请记录：
- 操作步骤
- 预期效果
- 实际效果
- 设备信息
